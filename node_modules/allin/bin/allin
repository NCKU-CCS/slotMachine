#!/usr/bin/env node
var _ = require('lodash');
var prog = require('commander');
var path = require('path');

var pkg = require('../package.json');
var allin = require('../index');
var fileSave = require('file-save');

var arg = process.argv;

var opt = {
  "minifyCSS": true,
  "minifyJS": true,
  "removeComments":true,
  "collapseWhitespace": true
}

// General options
prog
	.version(pkg.version)
	.usage('[options] <source to your html, default ./index.html>')
	.option('-m, --minifyall', 'Minify css, html, js, images.')
	.option('-o, --output <directory>', 'Path to output directory, defaults to current directory')
	.option('-n, --filename <filename>', 'Output html file name, default to output.html')
	.parse(arg)

// if empty
if(_.isEmpty(prog.args) && arg.length === 2)
   return prog.help();

if(!prog.minifyall) {
	opt = null;
}

var html = prog.args[0] ? prog.args[0] : './index.html';
var filename = prog.filename ? prog.filename : 'output.html';
var output = prog.output ? prog.output : './';

if(output) {
	allin(path.resolve(process.cwd(), html), opt, function(result) {
		fileSave(path.resolve(path.join(process.cwd(), output, filename)))
			.write(result);
	});
}